# Shop X Hedron (WIP)

[![deploy](https://github.com/falmar/shop-x-hedron/actions/workflows/deploy.yaml/badge.svg)](https://github.com/falmar/shop-x-hedron/actions/workflows/deploy.yaml)

<div style="text-align: center;">
    <img src="resources/docs/hedron-stability-stable-dif-xl.png" alt="Shop X Hedron" width="360"/>
    <div><small>Generated by: <a href="https://stability.ai/stable-diffusion" target="_blank">Stability AI Stable Diffusion XL</a></small></div>
</div>

## Notes

I have used DDD to define the program interfaces and the business logic, the code is located at `app/Domains` folder

The service interfaces were build around RPC with *Input *Output, similar to gRPC messages for request/response. Although this is just HTTP Rest API

The tests are located at `tests` folder. Services, Repos and Controllers are tested.

Locally Sqlite is used as database, but it can be changed to any other SQL database supported by Laravel. The hosted API uses MySQL. _There is very basic db seed for products._ 

Feel free to navigate the code, I have tried to keep it as simple as possible. If you have any questions please let me know.

### Running with hosted UI

- The API is hosted at [https://api.x-hedron.lavieri.dev](https://api.x-hedron.lavieri.dev)
- A rudimentary Shop UI is hosted at [https://shop.x-hedron.lavieri.dev/products](https://shop.x-hedron.lavieri.dev/products)

### OpenApi Spec with Swagger UI and Docker

```bash
# at project root directory
$ docker run -p 8081:8080 -v $PWD:/php-app \
  -e "SWAGGER_JSON=/php-app/api/v1/openapi.json" \
  swaggerapi/swagger-ui
```

Then open [http://localhost:8081](http://localhost:8081) in your browser, select the hosted API or the localhost API which

### Running locally

Init with docker compose

```bash
$ docker compose -f ./compose/local/compose.yaml up -d --build
```

Running containers should look like this:

```text
[+] Running 2/2
 ✔ Container shop-x-hedron-nginx-1  Started                                                                                                                                0.4s 
 ✔ Container shop-x-hedron-php-1    Started
```

Next commands:

```bash
$ cp .env.example .env
$ docker exec -it shop-x-hedron-php-1 sh
# once inside the container
$ composer install
$ php artisan migrate --seed
```

Everything should be ready to go. At this point you can use the Postman Collection or OpenAPI Specification to test the
API both are located at `api/` folder

### Running tests

```bash
$ docker exec -it shop-x-hedron-php-1 sh
# once inside the container
$ php artisan test
```

---
File structure:

```text
.
├── Carts
│   ├── CartItemRepositoryEloquent.php
│   ├── CartItemRepositoryInterface.php
│   ├── CartRepositoryEloquent.php
│   ├── CartRepositoryInterface.php
│   ├── CartService.php
│   ├── CartServiceInterface.php
│   ├── Entities
│   │   ├── Cart.php
│   │   └── CartItem.php
│   ├── Exceptions
│   │   ├── CartItemNotFoundException.php
│   │   ├── CartItemQuantityExceededStockException.php
│   │   ├── CartItemQuantityException.php
│   │   ├── CartNotFoundException.php
│   │   ├── InvalidUuidException.php
│   │   └── NoSessionIdException.php
│   ├── ServiceProvider.php
│   ├── Specs
├── Checkout
│   ├── CheckoutService.php
│   ├── CheckoutServiceInterface.php
│   ├── Exceptions
│   │   ├── CartItemProductMismatchException.php
│   │   └── NoCartItemsException.php
│   ├── ServiceProvider.php
│   ├── Specs
│   └── ValueObjects
└── Products
    ├── Entities
    │   └── Product.php
    ├── Exceptions
    │   ├── ProductNotFoundException.php
    │   └── ProductOutOfStockException.php
    ├── ProductRepositoryEloquent.php
    ├── ProductRepositoryInterface.php
    ├── ProductService.php
    ├── ProductServiceInterface.php
    ├── ServiceProvider.php
    └── Specs

```
